cmake_minimum_required(VERSION 3.5)
project(DBusCxx-avahi)

set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTORCC ON)
set(CMAKE_AUTOUIC ON)

find_package(Qt5 COMPONENTS Core REQUIRED)
add_compile_definitions( "QT_NO_KEYWORDS" )

include(FindPkgConfig)

pkg_check_modules( dbus-cxx REQUIRED dbus-cxx-qt-2.0 )

set( AVAHI_XML
    "org.freedesktop.Avahi.AddressResolver.xml;\
    org.freedesktop.Avahi.DomainBrowser.xml;\
    org.freedesktop.Avahi.EntryGroup.xml;\
    org.freedesktop.Avahi.HostNameResolver.xml;\
    org.freedesktop.Avahi.RecordBrowser.xml;\
    org.freedesktop.Avahi.Server.xml;\
    org.freedesktop.Avahi.ServiceBrowser.xml;\
    org.freedesktop.Avahi.ServiceResolver.xml;\
    org.freedesktop.Avahi.ServiceTypeBrowser.xml")
set( AUTOGENERATED_FILES
    AddressResolverProxy.cpp
    AddressResolverProxy.h
    DomainBrowserProxy.cpp
    DomainBrowserProxy.h
    EntryGroupProxy.cpp
    EntryGroupProxy.h
    HostNameResolverProxy.cpp
    HostNameResolverProxy.h
    org_freedesktop_Avahi_AddressResolverProxy.cpp
    org_freedesktop_Avahi_AddressResolverProxy.h
    org_freedesktop_Avahi_DomainBrowserProxy.cpp
    org_freedesktop_Avahi_DomainBrowserProxy.h
    org_freedesktop_Avahi_EntryGroupProxy.cpp
    org_freedesktop_Avahi_EntryGroupProxy.h
    org_freedesktop_Avahi_HostNameResolverProxy.cpp
    org_freedesktop_Avahi_HostNameResolverProxy.h
    org_freedesktop_Avahi_RecordBrowserProxy.cpp
    org_freedesktop_Avahi_RecordBrowserProxy.h
    org_freedesktop_Avahi_Server2Proxy.cpp
    org_freedesktop_Avahi_Server2Proxy.h
    org_freedesktop_Avahi_ServerProxy.cpp
    org_freedesktop_Avahi_ServerProxy.h
    org_freedesktop_Avahi_ServiceBrowserProxy.cpp
    org_freedesktop_Avahi_ServiceBrowserProxy.h
    org_freedesktop_Avahi_ServiceResolverProxy.cpp
    org_freedesktop_Avahi_ServiceResolverProxy.h
    org_freedesktop_Avahi_ServiceTypeBrowserProxy.cpp
    org_freedesktop_Avahi_ServiceTypeBrowserProxy.h
    RecordBrowserProxy.cpp
    RecordBrowserProxy.h
    ServerProxy.cpp
    ServerProxy.h
    ServiceResolverProxy.cpp
    ServiceResolverProxy.h
    ServiceTypeBrowserProxy.cpp
    ServiceTypeBrowserProxy.h
    ServieBrowserProxy.cpp
    ServieBrowserProxy.h )

foreach( xml_file ${AVAHI_XML} )
    string(STRIP ${xml_file} xml_file )
    message( "Generating files for ${xml_file}")
    execute_process( COMMAND dbus-cxx-xml2cpp --proxy --file --xml=${CMAKE_CURRENT_SOURCE_DIR}/${xml_file}
        WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR} )
endforeach()

add_executable( avahi-test avahi-test.cpp avahitester.cpp avahitester.h ${AUTOGENERATED_FILES} )

set_property( TARGET avahi-test PROPERTY CXX_STANDARD 17 )
target_include_directories( avahi-test  PUBLIC ${dbus-cxx_INCLUDE_DIRS} ${CMAKE_CURRENT_BINARY_DIR} )
target_link_libraries( avahi-test  ${dbus-cxx_LDFLAGS} Qt5::Core )
